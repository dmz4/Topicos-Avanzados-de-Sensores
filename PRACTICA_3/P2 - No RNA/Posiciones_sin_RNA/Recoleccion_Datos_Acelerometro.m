clear all;
% warning off
% load P.mat;
% load T.mat;
% pkg load instrument-control
% load P1.mat;
% load P2.mat;
% load P3.mat;
receiveFlag = false;
newData = false;

ts=0.1;
t=0:0.1:10;

maxValue=1023;
minValue=0;

value1=zeros(1,length(t));
value2=zeros(1,length(t));

valueN1=zeros(1,length(t));
valueN2=zeros(1,length(t));

arduino = serialport("COM8",9600);

pause(4);

disp('Recolectando Datos....')
for k=1:length(t)
  tic;
  flush(arduino,"output"); %srl_flush(arduino);
  data = read(arduino,11,"char");
  C=char(data);
  receiveFlag = false;
  for i=1:length(C)
    if receiveFlag == true
      if C(i) ~= '>'
        Aux(i-1)=C(i);
      else
        newData=true;
      end
    elseif C(i) == '<'
      receiveFlag = true;
    end
  end
  
  if newData == true
    Data=strsplit(Aux,',');
    value1(k)=str2num(Data{1,1});
    value2(k)=str2num(Data{1,2});
    newData=false;
  else
  value1(k)=value1(k-1);
  value2(k)=value2(k-1);
  end
  valueN1(k)=inputNorm(value1(k),minValue,maxValue);
  valueN2(k)=inputNorm(value2(k),minValue,maxValue);
  while toc<ts
  end
  tiempo(k)=toc;
end
disp('Datos Recolectados...')
arduino = [];
subplot(221)
plot(t,value1)
title('Real pitch angle')

% valueN1=[-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	0.00488758553274682	0.00488758553274682	0.00488758553274682	0.00488758553274682	0.00488758553274682	0.00488758553274682	0.00488758553274682	0.00488758553274682	0.00488758553274682	0.00488758553274682	0.00488758553274682	0.00488758553274682	0.00488758553274682	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364];
% valueN1=[];
subplot(222)
plot(t,valueN1)
title('Normalized pitch angle')
subplot(223)
plot(t,value2)
title('Real roll angle')
% valueN2=[-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	-0.000977517106549364	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	8.99022482893451	8.99022482893451	8.99022482893451	8.99022482893451	8.99022482893451	8.99022482893451	8.99022482893451	8.99022482893451	8.99022482893451	8.99022482893451	8.99022482893451	8.99022482893451	8.99022482893451	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	8.99022482893451	8.99022482893451	8.99022482893451	8.99022482893451	8.99022482893451	8.99022482893451	8.99022482893451	8.99022482893451	8.99022482893451	8.99022482893451	8.99022482893451	8.99022482893451	8.99022482893451	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747	9.04887585532747];
subplot(224)
plot(t,valueN2)
title('Normalized roll angle')
T1 = [1*ones(1,101);1*ones(1,101)];
T2 = [-1*ones(1,101);1*ones(1,101)];
T3 = [1*ones(1,101);-1*ones(1,101)];
T4 = [-1*ones(1,101);-1*ones(1,101)];
T = [T1 T2 T3 T4];
%----------------------------%
% P1=[valueN1;valueN2];
% P2=[valueN1;valueN2];
% P3=[valueN1;valueN2];
% P= [];
% P= [P1 P2 P3];